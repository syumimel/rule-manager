# ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç¢ºèª

## ðŸ“‹ ç¢ºèªæ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œï¼ˆæœ€é‡è¦ï¼‰

**Supabase Dashboard > SQL Editor** ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œï¼š

1. `supabase/migrations/008_create_message_logs_and_chat_settings.sql` ã®å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼
2. SQL Editorã«è²¼ã‚Šä»˜ã‘ã¦å®Ÿè¡Œ

ã¾ãŸã¯ã€`009_check_chat_status.sql` ã‚’å®Ÿè¡Œã—ã¦ã€ç¾åœ¨ã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

### ã‚¹ãƒ†ãƒƒãƒ—2: çŠ¶æ…‹ç¢ºèªSQLã®å®Ÿè¡Œ

Supabase Dashboard > SQL Editor ã§ `009_check_chat_status.sql` ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

**å®Ÿè¡Œæ–¹æ³•**: 
- **æ–¹æ³•1ï¼ˆæŽ¨å¥¨ï¼‰**: å„ãƒ–ãƒ­ãƒƒã‚¯ã‚’å€‹åˆ¥ã«å®Ÿè¡Œï¼ˆçµæžœãŒè¦‹ã‚„ã™ã„ï¼‰
- **æ–¹æ³•2**: å…¨ã¦ã‚’ä¸€åº¦ã«å®Ÿè¡Œï¼ˆçµæžœãŒè¤‡æ•°ã‚»ãƒƒãƒˆã«ãªã‚‹ï¼‰

**ç°¡å˜ãªç¢ºèª**: `009_check_chat_status_simple.sql` ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€é‡è¦ãªç¢ºèªã ã‘ã‚’ã¾ã¨ã‚ã¦å®Ÿè¡Œã§ãã¾ã™ã€‚

**çµæžœã®ç¢ºèª**:
- `message_logs_exists`: `true` ãªã‚‰OKï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ãŒå­˜åœ¨ï¼‰
- `total_messages`: 0ä»¶ãªã‚‰ã€ã¾ã ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€ä¿¡ã•ã‚Œã¦ã„ãªã„ï¼ˆã“ã‚ŒãŒå‹é”ä¸€è¦§ãŒç©ºã®åŽŸå› ï¼‰
- `unique_users`: 0ä»¶ãªã‚‰ã€ã¾ã LINEãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå­˜åœ¨ã—ãªã„

### ã‚¹ãƒ†ãƒƒãƒ—3: LINEã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¦ãƒ†ã‚¹ãƒˆ

1. LINEã‚¢ãƒ—ãƒªã§ã€Botã«å‹é”ç™»éŒ²
2. Botã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ï¼ˆä¾‹: ã€Œã“ã‚“ã«ã¡ã¯ã€ï¼‰
3. `message_logs`ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ‡ãƒ¼ã‚¿ãŒè¿½åŠ ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

### ã‚¹ãƒ†ãƒƒãƒ—4: Webhook URLã®ç¢ºèª

ç’°å¢ƒå¤‰æ•°ã®LINE_Webhook URLãŒæ­£ã—ã„ã‹ç¢ºèªï¼š
```
LINE_Webhook URL=https://unfluked-biramous-mitzie.ngrok-free.dev/api/webhook/line
```

**æ³¨æ„**: ã“ã®URLã¯é–‹ç™ºç’°å¢ƒï¼ˆngrokï¼‰ã®URLã§ã™ã€‚æœ¬ç•ªç’°å¢ƒï¼ˆVercelï¼‰ã®å ´åˆã¯ã€Vercelã®URLã«å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

## ðŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å‹é”ä¸€è¦§ãŒç©ºã®å ´åˆ

1. **ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª**
   ```sql
   SELECT EXISTS (
     SELECT FROM information_schema.tables 
     WHERE table_schema = 'public' 
     AND table_name = 'message_logs'
   );
   ```

2. **message_logsãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã‹ç¢ºèª**
   ```sql
   SELECT COUNT(*) FROM public.message_logs;
   ```

3. **LINEã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡**
   - Botã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ã¨ã€`message_logs`ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜ã•ã‚Œã¾ã™
   - ãã®å¾Œã€å‹é”ä¸€è¦§ã«è¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™

### WebhookãŒå‹•ä½œã—ãªã„å ´åˆ

1. **ngrokãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª**ï¼ˆé–‹ç™ºç’°å¢ƒã®å ´åˆï¼‰
   ```bash
   # ngrokãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
   curl http://localhost:4040/api/tunnels
   ```

2. **LINE Developers Consoleã§è¨­å®šç¢ºèª**
   - Webhook URLãŒæ­£ã—ã„ã‹
   - WebhookãŒã€Œåˆ©ç”¨å¯èƒ½ã€ã«ãªã£ã¦ã„ã‚‹ã‹

3. **ç’°å¢ƒå¤‰æ•°ã‚’ç¢ºèª**
   - `.env.local`ï¼ˆé–‹ç™ºç’°å¢ƒï¼‰
   - Vercel Dashboard > Settings > Environment Variablesï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰

