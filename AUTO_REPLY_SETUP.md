# 自動返信機能セットアップガイド

## 📋 必要な手順

### ステップ1: データベースマイグレーションの実行（必須）

自動返信機能を使用するには、まずデータベースマイグレーションを実行する必要があります。

1. [Supabase Dashboard](https://supabase.com/dashboard) にアクセス
2. プロジェクトを選択
3. **SQL Editor** を開く
4. **New query** をクリック
5. `supabase/migrations/012_create_auto_replies.sql` の内容をコピーして実行

### ステップ2: 自動返信の登録

1. チャット管理画面の「自動返信」メニューを開く
2. 「新規登録」ボタンをクリック
3. 以下を入力：
   - **キーワード**: マッチングするキーワード（例: "こんにちは"）
   - **マッチング方式**: 完全一致/含む/前方一致/後方一致
   - **返信タイプ**: テキスト または JSON
   - **返信内容**: テキストの場合は直接入力、JSONの場合はLINE Messaging API形式のJSONを入力
   - **優先順位**: 数値が大きいほど優先（デフォルト: 0）
   - **有効**: チェックを入れると有効化

4. 「登録」ボタンをクリック

### ステップ3: 動作確認

1. LINEから、登録したキーワードを含むメッセージを送信
2. 自動返信が返ってくることを確認

## 🔍 マイグレーションが実行されているか確認

Supabase Dashboard > SQL Editor で以下を実行：

```sql
-- auto_repliesテーブルが存在するか確認
SELECT EXISTS (
  SELECT FROM information_schema.tables 
  WHERE table_schema = 'public' 
  AND table_name = 'auto_replies'
) AS auto_replies_exists;
```

結果が `true` になれば、テーブルは作成されています。

## 📝 使用例

### 例1: シンプルなテキスト返信

- **キーワード**: "こんにちは"
- **マッチング方式**: 含む（contains）
- **返信タイプ**: テキスト
- **返信内容**: "こんにちは！ご質問がございましたらお気軽にどうぞ。"

### 例2: JSON返信（複数メッセージ）

- **キーワード**: "営業時間"
- **マッチング方式**: 含む（contains）
- **返信タイプ**: JSON
- **返信内容（JSON）**:
```json
[
  {
    "type": "text",
    "text": "営業時間について"
  },
  {
    "type": "text",
    "text": "平日: 10:00-18:00\n土日祝: 10:00-17:00"
  }
]
```

## ⚠️ 注意事項

- マイグレーションを実行しないと、自動返信機能は使用できません
- エラーが発生する場合は、Supabase Dashboard > Logs > Postgres Logs で確認してください


